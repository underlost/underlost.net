<!doctype html>
<html class="no-js" lang="en">
<head>
	<title>Tyler Rilling / PostgreSQL 8.4 on a Media Temple (dv) Server</title>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
	<meta name="viewport" content="initial-scale=1, maximum-scale=1, user-scalable=no, minimal-ui">
	<meta name="author" content="Tyler Rilling" />
	<meta name="description" content="I make web things. I also take photographs and play video games." />
	<meta name="copyright" content="&copy; Copyright 2002 to Present"/>
	<meta name="HandheldFriendly" content="True">
	<meta name="MobileOptimized" content="320">
	<meta http-equiv="cleartype" content="on">
	<meta name="apple-mobile-web-app-capable" content="yes">
	<meta name="apple-mobile-web-app-status-bar-style" content="black" />
	<link rel="shortcut icon" href="/assets/ico/favicon.ico">
	<link rel="stylesheet" href="/assets/css/underlost.min.css">
	<link href='http://fonts.googleapis.com/css?family=Roboto:100,300,400,100italic,300italic,400italic' rel='stylesheet' type='text/css'>
	<link href='https://underlost.net/feed.xml' rel='alternate' type='application/rss+xml' title='underlost.net' />
	<link rel="canonical" href="https://underlost.net/blog/postgres-dv4" />
	<link type="text/plain" rel="author" href="/humans.txt" />
	<meta name="twitter:card" content="summary">
	<meta name="twitter:site" content="@underlost">
	<meta name="twitter:creator" content="@underlost">
	<meta name="twitter:url" content="https://underlost.net">
	<meta name="twitter:title" content="Tyler / Underlost">
	<meta name="twitter:description" content="I make web things. I also take photographs and play video games.">
	<script type="text/javascript" src="/assets/js/modernizr.js"></script>
	<script>
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
		(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
		m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

	ga('create', 'UA-1247925-1', 'underlost.net');
	ga('send', 'pageview');
	</script>
</head>
	<body class="postgres-dv4">
		<img class="sr-only" src="/assets/img/thumbnail.jpg" alt="underlost.net"><a name="top"></a>
		<div id="wrapper">
    <header role="masthead" id="underlost-info" class="site-head fadeRight layout-foreground">
    <div class="site-head-inner">
        <a class="logo" href="/"><img src="/assets/img/logo.png" width="32" height="32" alt="underlost logo"></a>
        <h1 class="site-title"><a href="/" rel="home">Underlost</a></h1>
        <p class="site-subtitle">is <a href="/about">Tyler Rilling</a></p>
    </div>
    <nav class="site-nav vertical">
        <ul class="sections-nav list-unstyled">
            <span class="selection"></span>
            <li class="home-url selected">
                <a class="pjax site-nav-home" data-section="home" href="/"><strong>Home</strong></a>
            </li>
            <li class="about-url">
                <a class="pjax site-nav-about" data-section="colophon" href="/about/"><strong>About</strong></a>
            </li>
            <li class="portfolio-url">
                <a class="pjax site-nav-portfolio" data-section="works" href="/portfolio/"><strong>Selected Work</strong></a>
            </li>
            <li class="contact-url">
                <a class="pjax site-nav-contact" data-section="contact" href="/contact/"><strong>Contact</strong></a>
            </li>
            <li class="job-url">
                <a class="pjax site-nav-job" data-section="job" href="/job/"><strong>Hire Me</strong></a>
            </li>
        </ul>
    </nav>

</header>

    <div id="content">
        <div class="page">
    <section id="river">
        <header class="page-head">
            <div class="layout-foreground layout-fill-height">
                <div class="align-block">
                    <h1 class="page-title">PostgreSQL 8.4 on a Media Temple (dv) Server</h1>
                    <p class="page-description blog-description-tagline"></p>
                </div>
            </div>
        </header>

        <div class="post-page-wrapper">
            <h3 id="preface">Preface</h3>

<p>Last week Django 1.4 was officially released. With it brought a lot of new features, so I wanted to upgrade most of my projects as soon as I could. I use Heroku for almost all of my Django apps, and have a (dv) server from Media Temple for serving static content and database hosting. Up until Django’s new release, this worked really well. I soon discovered a problem though. A minimum of PostgreSQL 8.2 is now required. My server only had 8.1.</p>

<h3 id="the-problem">The Problem</h3>

<p>Now, there are all kinds of tutorials and guides walking you through an install or upgrade of PostgreSQL 8.x to other versions, including 9. What these guides fail to take into account is servers with the Plesk webadmin interface also running. According to Plesk’s release notes (which itself is hard to find), they only support up yo <strong>8.4</strong>. You can go with the 9.X branch, but then we miss out on the Plesk integration, and the ability to manage Postgres databases from the admin web interface.</p>

<p>One of the few nice things about Plesk is it comes with a handy updater/installer that will actually occasionally work. It can be accessed by running (as root, or anything equivalent):</p>

<pre class="terminal">/usr/local/psa/admin/sbin/autoinstaller</pre>

<p>After fixing a few errors, I successfully updated to the latest version of Plesk (10.4.4). While Plesk claims the auto-installer <strong>should</strong> install PostgreSQL to 8.4, they are wrong when it comes to CentOS 5. Instead, it only installs the 8.1 branch.</p>

<h3 id="the-solution">The Solution</h3>

<p>If you attempt to install via Yum, you will presented with two separate packages: ‘postgresql’ (8.1 branch) and ‘postgresql84’ (8.4.x branch). Either will install just fine. The server will start, and you can even start using it. While both technically work, only the 8.1 package will be recognized by Plesk. So, how do we solve this? We need to manually grab the latest 8.4 RPM package from PostgreSQL servers.</p>

<p>First, we’ll need to remove any and all existing packages:</p>

<pre class="terminal">yum remove postgresql</pre>

<p>And hide the current packages in the yum repo, by editing <strong>/etc/yum.repos.d/CentOS-Base.repo</strong> and adding this line to the <strong>base</strong> and <strong>updates</strong> sections:</p>

<pre class="terminal">exclude=postgresql*</pre>

<p>This will tell yum to ignore packages from the normal repos, and only display the packages from the <span class="caps">RPM</span> we’ll be using. So next we get PostgreSQL 8.4 directly from the PostgreSQL servers:</p>

<pre class="terminal">wget http://yum.postgresql.org/8.4/redhat/rhel-5-x86_64/pgdg-centos-8.4-3.noarch.rpm</pre>

<p>And install the rpm distribution:</p>

<pre class="terminal">rpm -ivh pgdg-centos-8.4-3.noarch.rpm</pre>

<p>From there we can install PostgreSQL like usual:</p>

<pre class="terminal">
yum list postgres*
yum install postgresql-server
service postgresql initdb
chkconfig postgresql on
service postgresql start
</pre>

<p>Next we begin the process of letting Plesk access it, by adding our Plesk admin account (make sure to use the same username/password as the plesk account):</p>

<pre class="terminal">
su postgres
createuser -slPE
</pre>

<p>We’re done as the Postgres user, so you can exit out of it:</p>

<pre class="terminal">exit</pre>

<p>Enable access for you to allow logins from the (dv) server. Edit <strong>/var/lib/pgsql/data/pg_hba.conf</strong> and comment out the line:</p>
<pre class="terminal">all all 127.0.0.1/32 ident</pre>

<p>And add this line:</p>
<pre class="terminal">all all 127.0.0.1/32 md5</pre>

<p>Finally, we can register PostgreSQL 8.4 with Plesk by using the command:</p>

<pre class="terminal">
/usr/local/psa/bin/database-server --update-server localhost:5432 -type postgresql -admin admin -passwd `cat /etc/psa/.psa.shadow` &amp;&amp; service psa restart</pre>

<p>If all went well, PostgreSQL 8.4 will finally be installed and accesible through Plesk/pgAdmin!</p>

        </div>

    </section>
</div>

    </div>

    <footer class="site-footer">
        <div class="inner">
            <ul class="list-inline secondary-nav">
                <li><a class="logo" href="/"><img src="/assets/img/logo.png" width="32" height="32" alt="underlost logo"></a></li>
                <li><a href="/about/">About</a></li>
                <li><a href="/portfolio/">Selected Work</a></li>
                <li><a href="/contact/">Contact</a></li>
            </ul>
            <small class="copyright">Copyright &copy; 2002–2015. Last <a href="https://github.com/underlost/underlost.net/">updated July 03, 2015</a>.</small>
        </div>
    </footer>

</div>

		<script type="text/javascript" src="/assets/js/libs/jquery-2.1.4.min.js"></script>
<script type="text/javascript" src="/assets/js/underlost.min.js"></script>

	</body>
</html>
